<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>{% block title %}{{ title or "Grillz Studio" }}{% endblock %}</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

  {% block stylesheets %}
  <link rel="stylesheet" href="/static/css/base.css" />
  {% endblock %}

  <style>
    :root{
      --gold-1:#d4af37; --gold-2:#f4d03f; --gold-3:#ffe38a;
      --onyx-0:#070707; --onyx-1:#0b0b0b; --onyx-2:#121212; --onyx-3:#1a1a1a; --onyx-4:#232323;
      --text-1:#fff; --text-2:rgba(255,255,255,.78); --text-3:rgba(255,255,255,.55);
      --brd-1:rgba(255,255,255,.10); --brd-2:rgba(255,255,255,.16);
      --glass:rgba(12,12,12,.6);
      --gold-alpha:rgba(212,175,55,.12);
      --radius-sm:8px; --radius-md:12px; --radius-lg:16px; --radius-2xl:22px;
      --shadow-1:0 8px 24px rgba(0,0,0,.35);
      --shadow-gold:0 10px 30px rgba(212,175,55,.28);
      --nav-h:64px;
    }

    html,body{
      height:100%;
      background:
        radial-gradient(1200px 600px at 90% -10%, rgba(212,175,55,.10), transparent 60%),
        radial-gradient(800px 400px at 0% 100%, rgba(255,235,150,.06), transparent 60%),
        linear-gradient(180deg, var(--onyx-1), var(--onyx-2) 30%, var(--onyx-1) 100%);
      color:var(--text-1);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Auric grain (subtle shimmer) */
    body::before{
      content:""; position:fixed; inset:-20%; pointer-events:none; z-index:-1;
      background:
        conic-gradient(from 0deg at 50% 50%, rgba(255,255,255,.02) 0 10%, transparent 10% 20%, rgba(255,255,255,.02) 20% 30%, transparent 30% 40%, rgba(255,255,255,.02) 40% 50%, transparent 50% 60%, rgba(255,255,255,.02) 60% 70%, transparent 70% 80%, rgba(255,255,255,.02) 80% 90%, transparent 90% 100%);
      filter: blur(1px);
      opacity:.7;
      animation: auric-rotate 24s linear infinite;
    }
    @keyframes auric-rotate { to{ transform: rotate(360deg);} }

    /* Glass nav with gold accent */
    .navbar{
      position:sticky; top:0; z-index:40; height:var(--nav-h);
      background:linear-gradient(180deg, rgba(10,10,10,.75), rgba(10,10,10,.55));
      backdrop-filter: blur(14px);
      border-bottom:1px solid var(--brd-1);
    }
    .nav-container{
      height:var(--nav-h); max-width:1200px; margin:0 auto; padding:0 16px;
      display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .logo a{ display:flex; align-items:center; gap:10px; color:var(--text-1); text-decoration:none; }
    .logo-icon{
      color:#111; width:36px; height:36px; border-radius:10px; display:grid; place-items:center;
      background: linear-gradient(135deg, var(--gold-1), var(--gold-2));
      box-shadow: inset 0 1px 2px rgba(255,255,255,.35), 0 6px 18px rgba(212,175,55,.35);
    }
    .logo-text{ font-family: "Playfair Display", serif; font-weight:700; letter-spacing:.2px; }

    .nav-links{ display:flex; align-items:center; gap:14px; }
    .nav-link, .auth-button{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:12px; text-decoration:none; font-weight:600; font-size:.9rem;
      color:var(--text-2); border:1px solid transparent; transition:.25s ease;
      background: transparent;
    }
    .nav-link:hover{ color:var(--text-1); background:var(--onyx-3); border-color:var(--brd-1); }
    .nav-link.active{ color:#151515; background: linear-gradient(135deg, var(--gold-1), var(--gold-2)); box-shadow: var(--shadow-gold); }
    .auth-button{
      background:linear-gradient(135deg, var(--onyx-3), var(--onyx-4));
      border:1px solid var(--brd-1); color:var(--text-1);
    }
    .auth-button:hover{ border-color: var(--gold-1); box-shadow: 0 0 0 2px rgba(212,175,55,.18) inset; }

    .mobile-menu-toggle{
      display:none; background:transparent; color:var(--text-1); border:1px solid var(--brd-1);
      width:40px; height:40px; border-radius:12px;
    }

    .main-content{ min-height:calc(100dvh - var(--nav-h)); padding:28px 0; }

    /* Modern 4.5s Loader */
    .static-loading-screen{
      position: fixed; inset:0; z-index:99999; display:flex; align-items:center; justify-content:center; flex-direction:column;
      background:
        radial-gradient(1200px 600px at 90% -10%, rgba(212,175,55,.12), transparent 60%),
        radial-gradient(900px 500px at 10% 110%, rgba(255,230,140,.08), transparent 60%),
        linear-gradient(180deg, var(--onyx-0), var(--onyx-1) 40%, var(--onyx-0));
      opacity:1; transition: opacity .5s ease;
    }
    .static-loading-content{
      text-align:center; position:relative; padding:28px 32px; border-radius:18px;
      background: linear-gradient(180deg, rgba(20,20,20,.65), rgba(20,20,20,.35));
      border: 0.5px solid var(--brd-2);
      box-shadow: var(--shadow-1);
    }

    /* Premium ring spinner with orbiting sparkles */
    .elegant-spinner{
      --size: 72px;
      width: var(--size); height: var(--size); position: relative; border-radius:50%; margin:0 auto 14px;
      /* Gold conic sheen */
      background:
        conic-gradient(from 0deg,
          rgba(255,255,255,.00) 0deg,
          rgba(255,255,255,.12) 30deg,
          rgba(255,255,255,.00) 60deg,
          rgba(255,255,255,.22) 120deg,
          rgba(255,255,255,.00) 200deg,
          rgba(255,255,255,.16) 260deg,
          rgba(255,255,255,.00) 360deg),
        radial-gradient(closest-side, transparent calc(100% - 8px), var(--gold-1) calc(100% - 8px));
      /* Cut out the center to create a ring */
      -webkit-mask: radial-gradient(closest-side, transparent calc(100% - 8px), #000 calc(100% - 8px));
      mask: radial-gradient(closest-side, transparent calc(100% - 8px), #000 calc(100% - 8px));
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.15), 0 14px 40px rgba(212,175,55,.24);
      animation: spin 1.05s linear infinite;
    }
    /* Moving gold highlight on the ring */
    .elegant-spinner::before{
      content:""; position:absolute; inset:-6px; border-radius:50%;
      background: conic-gradient(from 0deg, transparent 0deg, var(--gold-2) 4deg, transparent 14deg);
      -webkit-mask: radial-gradient(closest-side, transparent calc(100% - 8px), #000 calc(100% - 8px));
      animation: spin 1.05s linear infinite reverse;
      filter: blur(.4px);
      opacity:.9;
    }
    /* Orbiting diamond sparkle */
    .elegant-spinner::after{
      content:""; position:absolute; left:50%; top:2px; width:12px; height:12px; transform-origin: calc(var(--size)/2 - 6px) calc(var(--size)/2 - 6px);
      background:
        radial-gradient(circle at 40% 40%, #fff 0 35%, transparent 36%),
        radial-gradient(circle at 60% 60%, #ffe9a9 0 45%, transparent 46%);
      border-radius:50%;
      box-shadow: 0 0 12px 3px rgba(255,235,160,.55), 0 0 30px 10px rgba(212,175,55,.25);
      animation: orbit 1.05s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    @keyframes orbit{ to{ transform: rotate(360deg); } }

    /* Twinkling micro-sparkles behind the spinner */
    .sparkle-field{
      position:absolute; inset:-40px; pointer-events:none; filter: drop-shadow(0 0 6px rgba(255,230,160,.25));
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255,240,190,.25) 0 2px, transparent 3px),
        radial-gradient(circle at 80% 40%, rgba(255,245,210,.22) 0 2px, transparent 3px),
        radial-gradient(circle at 60% 80%, rgba(255,230,150,.20) 0 2px, transparent 3px);
      background-size: 220px 160px, 240px 180px, 260px 200px;
      animation: twinkle 2.4s ease-in-out infinite alternate;
    }
    @keyframes twinkle{
      0%{ opacity:.45; transform: translateY(2px) scale(1); }
      100%{ opacity:.9; transform: translateY(-2px) scale(1.02); }
    }

    .elegant-loading-text{
      font-family: Inter, sans-serif; font-weight: 400; font-size: 1.06rem;
      color: var(--gold-3); letter-spacing: .12em; text-transform: uppercase;
      text-shadow: 0 1px 2px #000, 0 0 2px #ffe06644;
      opacity:.9;
    }
    .tagline{
      margin-top:6px; color:var(--text-3); font-size:.85rem; letter-spacing:.06em;
    }

    /* Utilities */
    @media (max-width: 900px){
      .nav-links{ display:none; }
      .mobile-menu-toggle{ display:inline-grid; place-items:center; }
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; }
    }
  </style>

  <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://unpkg.com https://cdnjs.cloudflare.com https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
        img-src 'self' data: https:;
        connect-src 'self';
        frame-src 'none';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    ">
</head>
<body>

  <div class="static-loading-screen" id="staticLoadingScreen" aria-hidden="true">
    <div class="static-loading-content" role="status" aria-live="polite">
      <div class="sparkle-field" aria-hidden="true"></div>
      <div class="elegant-spinner" aria-hidden="true"></div>
      <div class="elegant-loading-text">Polishing your shineâ€¦</div>
      <div class="tagline">Hand-crafted visuals. Real-time brilliance.</div>
    </div>
  </div>

  <nav class="navbar">
    <div class="nav-container">
      <div class="logo">
        <a href="/dashboard" aria-label="Grillz Studio home">
          <svg width="24" height="24" viewBox="0 0 24 24" class="logo-icon" aria-hidden="true" focusable="false">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
          <span class="logo-text">Grillz Studio</span>
        </a>
      </div>

      <div class="nav-links">
        <button class="auth-button signout-btn" onclick="redirect()">Back to Dashboard</button>
      </div>

      <button class="mobile-menu-toggle" aria-label="Toggle menu">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </nav>


  <main class="main-content">
    {% block content %}{% endblock %}
  </main>


  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="/static/js/base.js"></script>


  {% block scripts %}{% endblock %}

  <script>
    // Spinner control: 4.5s on /studio, quick on others
    window.addEventListener('DOMContentLoaded', function(){
      var spinner = document.getElementById('staticLoadingScreen');
      var path = window.location.pathname;
      var spinnerDuration = (path === '/studio') ? 4500 : 600; // 4.5s on studio

      setTimeout(function(){
        if (!spinner) return;
        spinner.style.opacity = '0';
        setTimeout(function(){ spinner.style.display = 'none'; }, 500);
      }, spinnerDuration);
    });

    // Global auth management
    let authToken = localStorage.getItem('authToken');
    let refreshToken = localStorage.getItem('refreshToken');

    if (authToken) {
      axios.defaults.headers.common['Authorization'] = 'Bearer ' + authToken;
    }

    async function redirect(){ window.location.href = '/dashboard'; }

    async function refreshAuthToken() {
      if (!refreshToken) return false;
      try {
        const response = await axios.post('/auth/refresh', { refresh_token: refreshToken });
        authToken = response.data.access_token;
        refreshToken = response.data.refresh_token;
        localStorage.setItem('authToken', authToken);
        localStorage.setItem('refreshToken', refreshToken);
        axios.defaults.headers.common['Authorization'] = 'Bearer ' + authToken;
        return true;
      } catch (error) {
        console.log('Token refresh failed:', error);
        localStorage.removeItem('authToken');
        localStorage.removeItem('refreshToken');
        return false;
      }
    }

    axios.interceptors.response.use(
      (response) => response,
      async (error) => {
        if (error.response?.status === 401 && refreshToken) {
          const refreshed = await refreshAuthToken();
          if (refreshed) {
            error.config.headers.Authorization = 'Bearer ' + authToken;
            return axios.request(error.config);
          }
        }
        return Promise.reject(error);
      }
    );
  </script>
</body>
</html>